name: Birthday Mail

on:
  schedule:
    - cron: "0 3 * * *"
  workflow_dispatch:

jobs:
  send-birthday-mail:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Check birthday & send mail
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          TO_EMAIL: ${{ secrets.TO_EMAIL }}
        run: |
          BDAY_DAY=12
          BDAY_MONTH=7
          TODAY_DAY=$(date +%d)
          TODAY_MONTH=$(date +%m)

          if [ "$TODAY_DAY" = "$BDAY_DAY" ] && [ "$TODAY_MONTH" = "$BDAY_MONTH" ]; then
            echo "ðŸŽ‚ Birthday detected. Sending email..."

            python3 <<'EOF'
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

subject = "ðŸŒ™ Today feels differentâ€¦"

body = """
à¤•à¤¿à¤žà¥à¤šà¤¿à¤¤à¥ à¤…à¤ªà¤¿ à¤ªà¥à¤°à¤¤à¥€à¤•à¥à¤·à¤¤à¥‡â€¦ ðŸŒ™

Some days arrive quietly,
yet stay longer than expected.

Open it when you feel ready:
https://pratikmule127.github.io/anvesha-birthday/

â€” PD
"""

msg = MIMEMultipart()
msg["From"] = "${EMAIL_USER}"
msg["To"] = "${TO_EMAIL}"
msg["Subject"] = subject
msg.attach(MIMEText(body, "plain", "utf-8"))

server = smtplib.SMTP("smtp.gmail.com", 587)
server.starttls()
server.login("${EMAIL_USER}", "${EMAIL_PASS}")
server.send_message(msg)
server.quit()
EOF

          else
            echo "Not birthday today."
          fi
